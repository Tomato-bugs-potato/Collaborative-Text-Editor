From 14b02465cd6c5d5a1a778bbedfc0d6ab84596312 Mon Sep 17 00:00:00 2001
From: MichaelWorkineh_git <micwor96@gmail.com>
Date: Fri, 5 Dec 2025 20:10:03 +0300
Subject: [PATCH 03/12] update: doc save api route fixs

---
 client/src/App.js             | 6 +++---
 client/src/TextEditor.js      | 5 ++++-
 services/api-gateway/index.js | 2 +-
 3 files changed, 8 insertions(+), 5 deletions(-)

diff --git a/client/src/App.js b/client/src/App.js
index 73d57d7..a52038b 100644
--- a/client/src/App.js
+++ b/client/src/App.js
@@ -26,7 +26,7 @@ function DocumentList() {
   const fetchDocuments = async () => {
     try {
       const token = localStorage.getItem('authToken');
-      const response = await fetch(`${DOCUMENTS_BASE_URL}/documents`, {
+      const response = await fetch(DOCUMENTS_BASE_URL, {
         headers: {
           'Authorization': `Bearer ${token}`
         }
@@ -46,7 +46,7 @@ function DocumentList() {
   const createDocument = async () => {
     try {
       const token = localStorage.getItem('authToken');
-      const response = await fetch(`${DOCUMENTS_BASE_URL}/documents`, {
+      const response = await fetch(DOCUMENTS_BASE_URL, {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json',
@@ -193,7 +193,7 @@ function App() {
       if (token && userData) {
         try {
           // Validate token by making a request to a protected endpoint
-          const response = await fetch(`${DOCUMENTS_BASE_URL}/documents`, {
+          const response = await fetch(DOCUMENTS_BASE_URL, {
             headers: {
               'Authorization': `Bearer ${token}`
             }
diff --git a/client/src/TextEditor.js b/client/src/TextEditor.js
index f8d7a09..33fcd24 100644
--- a/client/src/TextEditor.js
+++ b/client/src/TextEditor.js
@@ -97,20 +97,23 @@ export default function TextEditor() {
 
         if (response.ok) {
           const data = await response.json();
-          if (data.success && data.data && data.data.data) {
+          if (data.success && data.data && data.data.data && Object.keys(data.data.data).length > 0) {
             console.log("Loading document content from document service:", data.data.data);
             quill.setContents(data.data.data);
             quill.enable();
           } else {
             console.log("No content found, starting with empty document");
+            quill.setText("");
             quill.enable();
           }
         } else {
           console.error("Failed to load document content");
+          quill.setText("");
           quill.enable();
         }
       } catch (error) {
         console.error("Error loading document content:", error);
+        quill.setText("");
         quill.enable();
       }
     };
diff --git a/services/api-gateway/index.js b/services/api-gateway/index.js
index bf52ae5..5768b22 100644
--- a/services/api-gateway/index.js
+++ b/services/api-gateway/index.js
@@ -79,7 +79,7 @@ app.use('/api/documents', authenticateRequest, createProxyMiddleware({
   },
   changeOrigin: true,
   pathRewrite: {
-    '^/api/documents': ''
+    '^/api/documents': '/documents'
   }
 }));
 
-- 
2.44.0.windows.1

